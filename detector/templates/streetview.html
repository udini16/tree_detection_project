<!DOCTYPE html>
<html>
<head>
    <title>Google Street View Scanner</title>
    <style>
        #street-view {
            width: 100%;
            height: 90vh;
        }
        #scan-button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h2>Subang Jaya Street View</h2>
    <div id="street-view"></div>
    <button id="scan-button" onclick="captureView()">Scan Trees</button>

    <!-- Hidden form -->
    <form id="scan-form" method="POST" action="/streetview/">
        {% csrf_token %}
        <input type="hidden" name="image" id="image-data">
    </form>

    <script>
        let panorama;

        function initStreetView() {
            const subangLocation = { lat: 3.0738, lng: 101.5183 }; // Subang Jaya
            panorama = new google.maps.StreetViewPanorama(
                document.getElementById("street-view"), {
                    position: subangLocation,
                    pov: { heading: 165, pitch: 0 },
                    zoom: 1
                }
            );
        }

        function captureView() {
            // Take screenshot of street view
            html2canvas(document.querySelector("#street-view")).then(canvas => {
                // Put screenshot into hidden input
                document.getElementById("image-data").value = canvas.toDataURL("image/jpeg");
                // Submit form to Django
                document.getElementById("scan-form").submit();
            });
        }
    </script>

    <!-- html2canvas library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- Google Maps API -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAMu7thhl-4jL8KF6GGkTCZ9UFAx9yL9eg&callback=initStreetView">
    </script>
</body>
</html>
